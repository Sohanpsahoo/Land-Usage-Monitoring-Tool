<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Land Classification AI - Model</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --background-color: #f8f9fa;
            --text-color: #2c3e50;
            --border-radius: 12px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --card-bg: white;
            --insight-bg: #f8f9fa;
            --upload-bg: #f8f9fa;
            --upload-hover-bg: #f0f7ff;
        }

        [data-theme="dark"] {
            --primary-color: #ecf0f1;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --background-color: #1a1a1a;
            --text-color: #ecf0f1;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --card-bg: #2d2d2d;
            --insight-bg: #333333;
            --upload-bg: #333333;
            --upload-hover-bg: #404040;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 180px 0 120px;
            margin: 0 -20px 50px -20px;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(to bottom, transparent, var(--background-color));
        }

        .header h1 {
            color: white;
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2.5rem;
            margin-bottom: 30px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--secondary-color);
            border-radius: 5px 0 0 5px;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .card-title i {
            color: var(--secondary-color);
            font-size: 2rem;
        }

        .upload-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 2.5rem;
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            transition: var(--transition);
            background: var(--upload-bg);
        }

        .upload-section:hover {
            border-color: var(--secondary-color);
            background: var(--upload-hover-bg);
        }

        .preview-section {
            margin: 30px 0;
            text-align: center;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        #imagePreview {
            max-width: 100%;
            max-height: 600px;
            display: none;
            margin: 20px auto;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            object-fit: contain;
            transition: var(--transition);
        }

        #imagePreview:hover {
            transform: scale(1.02);
        }

        .button {
            background-color: var(--secondary-color);
            color: white;
            padding: 1rem 2.5rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 500;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            margin-top: 30px;
            padding: 25px;
            border-radius: var(--border-radius);
            background-color: var(--insight-bg);
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .confidence-chart {
            margin: 2rem 0;
            padding: 1.5rem;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 100%;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin: 1rem 0;
        }

        .prediction-details {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .prediction-details h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prediction-details h3 i {
            color: var(--secondary-color);
        }

        .prediction-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-item {
            padding: 1rem;
            background: var(--insight-bg);
            border-radius: var(--border-radius);
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .insights-section {
            margin-top: 30px;
            padding: 25px;
            border-radius: var(--border-radius);
            background-color: var(--insight-bg);
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .toggle-button {
            background-color: var(--secondary-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 1rem 0;
            width: 100%;
        }

        .toggle-button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .toggle-button i {
            transition: transform 0.3s ease;
        }

        .toggle-button.active i {
            transform: rotate(180deg);
        }

        .collapsible {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .collapsible.show {
            display: block;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .insight-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .insight-card:hover {
            transform: translateY(-5px);
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .insight-icon {
            font-size: 1.5rem;
            color: var(--secondary-color);
        }

        .insight-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            font-weight: 500;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .trend-up {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
        }

        .trend-down {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--accent-color);
        }

        .trend-stable {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--secondary-color);
        }

        .recommendations {
            margin-top: 20px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: var(--insight-bg);
            border-radius: var(--border-radius);
        }

        .recommendation-icon {
            color: var(--secondary-color);
            margin-top: 3px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: var(--card-bg);
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: var(--transition);
        }

        .result-item:hover {
            transform: translateX(5px);
        }

        .result-label {
            font-weight: 500;
            color: var(--text-color);
        }

        .result-value {
            font-weight: 600;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 30px 0;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .feature-card {
            background: var(--card-bg);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--secondary-color);
            border-radius: 5px 0 0 5px;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 2.5rem;
            color: var(--secondary-color);
            margin-bottom: 1.5rem;
        }

        .feature-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .info-section {
            margin-top: 2rem;
            padding: 2.5rem;
            background: var(--insight-bg);
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }

        .info-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--secondary-color);
            border-radius: 5px 0 0 5px;
        }

        .info-section h3 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5rem;
        }

        .info-section h3 i {
            color: var(--secondary-color);
            font-size: 1.8rem;
        }

        .info-section ul {
            list-style: none;
            padding: 0;
        }

        .info-section li {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.1rem;
            padding: 0.5rem 0;
        }

        .info-section li i {
            color: var(--success-color);
            font-size: 1.2rem;
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--secondary-color);
            border-radius: 5px 0 0 5px;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }

        .stat-label {
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .header {
                padding: 150px 0 100px;
                margin: 0 -15px 40px -15px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .card, .feature-card, .stat-card {
                padding: 2rem;
            }
            
            .button {
                width: 100%;
                margin: 10px 0;
            }

            .features-grid, .stats-section {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .theme-toggle i {
            font-size: 1.5rem;
            color: var(--secondary-color);
        }

        .navbar {
            background-color: var(--primary-color) !important;
            padding: 1rem 0;
            box-shadow: var(--box-shadow);
            width: 100%;
            z-index: 1000;
        }

        .navbar .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .navbar-brand {
            font-weight: 600;
            font-size: 1.5rem;
            color: white !important;
        }

        .nav-link {
            font-weight: 500;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.8) !important;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
        }

        .nav-link:hover, .nav-link.active {
            color: var(--secondary-color) !important;
            background: rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 768px) {
            .navbar .container {
                padding: 0 15px;
            }
        }

        .container {
            margin-top: 80px;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            padding: 2rem 0;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .nav-button {
            background-color: var(--secondary-color);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            box-shadow: var(--box-shadow);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            background-color: #2980b9;
            color: white;
            text-decoration: none;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        [data-theme="dark"] .nav-button {
            background-color: #3498db;
            color: white;
        }

        [data-theme="dark"] .nav-button:hover {
            background-color: #2980b9;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        @media (max-width: 768px) {
            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }

            .nav-button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
        <i class="fas fa-moon"></i>
    </button>

    <div class="container">
        <div class="header">
            <h1>Land Cover Classification</h1>
            <p>Advanced AI-powered tool for satellite image analysis and land cover classification</p>
        </div>

        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <h3 class="feature-title">Deep Learning</h3>
                <p>Powered by state-of-the-art deep learning models trained on extensive satellite imagery datasets.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3 class="feature-title">High Accuracy</h3>
                <p>Achieves over 95% accuracy in land cover classification across various terrain types.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <h3 class="feature-title">Fast Processing</h3>
                <p>Quick analysis and classification of satellite images in seconds.</p>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title"><i class="fas fa-upload"></i> Upload & Classify</h2>
            
            <div class="upload-section">
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                <button class="button" onclick="document.getElementById('imageUpload').click()">
                    <i class="fas fa-cloud-upload-alt"></i> Choose Image
                </button>
                <p style="margin-top: 15px; color: #666;">Supported formats: JPG, PNG</p>
            </div>

            <div class="preview-section">
                <img id="imagePreview" alt="Preview">
            </div>

            <div style="text-align: center;">
                <button class="button" id="classifyButton" disabled>
                    <i class="fas fa-magic"></i> Classify Image
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>Processing image...</p>
            </div>

            <div class="results" id="results">
                <h2 class="card-title"><i class="fas fa-chart-pie"></i> Classification Results</h2>
                <div class="result-item">
                    <span class="result-label">Land Cover Type:</span>
                    <span class="result-value" id="landType">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Confidence:</span>
                    <span class="result-value" id="confidence">-</span>
                </div>

                <div class="confidence-chart">
                    <h3><i class="fas fa-chart-bar"></i> Confidence Analysis</h3>
                    <div class="chart-container">
                        <canvas id="confidenceChart"></canvas>
                    </div>
                </div>

                <div class="prediction-details">
                    <h3><i class="fas fa-info-circle"></i> Prediction Details</h3>
                    <div class="prediction-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="processingTime">-</div>
                            <div class="stat-label">Processing Time</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="modelVersion">v1.0</div>
                            <div class="stat-label">Model Version</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="imageSize">-</div>
                            <div class="stat-label">Image Size</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="insights-section" id="insights">
                <h2 class="card-title"><i class="fas fa-lightbulb"></i> Land Use Insights</h2>
                
                <button class="toggle-button" id="insightsToggle">
                    <i class="fas fa-chevron-down"></i>
                    View Land Usage Insights
                </button>
                
                <div class="collapsible" id="insightsContent">
                <div class="insights-grid">
                    <div class="insight-card">
                        <div class="insight-header">
                            <i class="fas fa-chart-line insight-icon"></i>
                            <h3 class="insight-title">Future Trends</h3>
                        </div>
                        <p id="futureTrends">Loading trends analysis...</p>
                            <div class="trend-indicator" id="trendIndicator"></div>
                    </div>

                    <div class="insight-card">
                        <div class="insight-header">
                            <i class="fas fa-city insight-icon"></i>
                            <h3 class="insight-title">Urban Planning</h3>
                        </div>
                        <p id="urbanPlanning">Loading urban planning insights...</p>
                    </div>

                    <div class="insight-card">
                        <div class="insight-header">
                            <i class="fas fa-leaf insight-icon"></i>
                            <h3 class="insight-title">Conservation</h3>
                        </div>
                        <p id="conservation">Loading conservation recommendations...</p>
                        </div>
                    </div>
                </div>

                <button class="toggle-button" id="recommendationsToggle">
                    <i class="fas fa-chevron-down"></i>
                    View Recommendations
                </button>

                <div class="collapsible" id="recommendationsContent">
                <div class="recommendations">
                    <h3 class="card-title"><i class="fas fa-clipboard-list"></i> Recommendations</h3>
                    <div id="recommendationsList">
                        <div class="recommendation-item">
                            <i class="fas fa-check-circle recommendation-icon"></i>
                            <span>Loading recommendations...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-number">10+</div>
                <div class="stat-label">Land Cover Types</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">95%</div>
                <div class="stat-label">Classification Accuracy</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">27K</div>
                <div class="stat-label">Training Images</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">5s</div>
                <div class="stat-label">Average Processing Time</div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title"><i class="fas fa-info-circle"></i> About This Tool</h2>
            <div class="info-section">
                <p>This advanced tool uses deep learning to classify satellite images into different land cover types. The model has been trained on the EuroSAT dataset and can accurately identify various land cover categories.</p>
                
                <h3><i class="fas fa-list"></i> Supported Land Cover Types:</h3>
                <ul>
                    <li><i class="fas fa-check"></i> Forests</li>
                    <li><i class="fas fa-check"></i> Water bodies</li>
                    <li><i class="fas fa-check"></i> Urban areas</li>
                    <li><i class="fas fa-check"></i> Agricultural land</li>
                    <li><i class="fas fa-check"></i> Industrial areas</li>
                    <li><i class="fas fa-check"></i> Pasture land</li>
                    <li><i class="fas fa-check"></i> Highway</li>
                    <li><i class="fas fa-check"></i> River</li>
                    <li><i class="fas fa-check"></i> Sea & Lake</li>
                    <li><i class="fas fa-check"></i> Herbaceous vegetation</li>
                </ul>
            </div>
        </div>

        <div class="nav-buttons">
            <a href="/landing" class="nav-button">
                <i class="fas fa-home"></i> Home Page
            </a>
            <a href="/implementations" class="nav-button">
                <i class="fas fa-cogs"></i> Implementations
            </a>
            <a href="/about" class="nav-button">
                <i class="fas fa-info-circle"></i> About Us
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const classifyButton = document.getElementById('classifyButton');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const landType = document.getElementById('landType');
        const confidence = document.getElementById('confidence');

        const GEMINI_API_KEY = 'AIzaSyAK8obivhQ8T9mF-dGC-SnaZ7GutGQF4e0';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';

        let confidenceChart = null;

        function generateDynamicPrompt(landType, promptType) {
                const prompts = {
                river: {
                    futureTrends: [
                        `Provide a brief analysis (100-150 words) of future trends for ${landType} river ecosystems. Focus on key climate impacts, water patterns, and environmental changes.`,
                        `Summarize (100-150 words) future developments for ${landType} river systems, including water quality, biodiversity, and human impact.`,
                        `Give a concise forecast (100-150 words) of environmental changes for ${landType} river environments, focusing on seasonal variations and conservation.`
                    ],
                    urbanPlanning: [
                        `Briefly outline (100-150 words) urban planning insights for areas near ${landType} rivers, focusing on flood prevention and sustainable development.`,
                        `Provide a short summary (100-150 words) of development strategies for communities around ${landType} rivers, including water management.`,
                        `Give concise recommendations (100-150 words) for ${landType} riverfront areas, focusing on accessibility and conservation.`
                    ],
                    conservation: [
                        `Summarize (100-150 words) key conservation strategies for ${landType} river ecosystems, focusing on water quality and wildlife protection.`,
                        `Briefly outline (100-150 words) environmental protection measures for ${landType} rivers, including biodiversity and pollution control.`,
                        `Provide a concise list (100-150 words) of conservation approaches for ${landType} river environments.`
                    ],
                    recommendations: [
                        `List 3-4 specific, actionable recommendations (100-150 words total) for managing ${landType} rivers.`,
                        `Provide 3-4 targeted suggestions (100-150 words total) for protecting ${landType} river ecosystems.`,
                        `Give 3-4 practical measures (100-150 words total) for maintaining ${landType} river environments.`
                    ]
                }
            };

            // Add more land types with their specific prompts
            const defaultPrompts = {
                futureTrends: [
                    `Provide a brief analysis (100-150 words) of future trends for ${landType} areas, focusing on climate change and urbanization impacts.`,
                    `Summarize (100-150 words) future developments for ${landType} regions, including land use changes and biodiversity.`,
                    `Give a concise forecast (100-150 words) of environmental changes for ${landType} environments.`
                ],
                urbanPlanning: [
                    `Briefly outline (100-150 words) urban planning insights for ${landType} areas, focusing on sustainable development.`,
                    `Provide a short summary (100-150 words) of development strategies for ${landType} regions.`,
                    `Give concise recommendations (100-150 words) for ${landType} zones, focusing on accessibility and conservation.`
                ],
                conservation: [
                    `Summarize (100-150 words) key conservation strategies for ${landType} areas, focusing on biodiversity protection.`,
                    `Briefly outline (100-150 words) environmental protection measures for ${landType} regions.`,
                    `Provide a concise list (100-150 words) of conservation approaches for ${landType} environments.`
                ],
                recommendations: [
                    `List 3-4 specific, actionable recommendations (100-150 words total) for managing ${landType} areas.`,
                    `Provide 3-4 targeted suggestions (100-150 words total) for protecting ${landType} environments.`,
                    `Give 3-4 practical measures (100-150 words total) for maintaining ${landType} regions.`
                ]
            };

            const landTypePrompts = prompts[landType.toLowerCase()] || defaultPrompts;
            const promptArray = landTypePrompts[promptType];
            return promptArray[Math.floor(Math.random() * promptArray.length)];
        }

        function parseMarkdown(text) {
            // Clean up any unwanted text or formatting
            text = text
                .replace(/Analyzing\.\.\./gi, '') // Remove all variations of "Analyzing..."
                .replace(/Analyzing/gi, '') // Remove just "Analyzing"
                .replace(/\.\.\./g, '') // Remove ellipsis
                .replace(/there is this extra text in future trends section\./g, '')
                .replace(/\s{2,}/g, ' ') // Replace multiple spaces with single space
                .trim();
            
            // Convert markdown to HTML
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                .replace(/\*(.*?)\*/g, '<em>$1</em>') // Italic
                .replace(/\n/g, '<br>') // Line breaks
                .replace(/- (.*?)(?:\n|$)/g, '<li>$1</li>') // List items
                .replace(/^\s*<li>/gm, '<ul><li>') // Start unordered list
                .replace(/<\/li>\s*$/gm, '</li></ul>'); // End unordered list
        }

        async function generateInsights(landType) {
            try {
                const insights = {};
                const startTime = Date.now();

                // Clear the trend indicator initially
                document.getElementById('trendIndicator').textContent = '';

                for (const promptType of ['futureTrends', 'urbanPlanning', 'conservation', 'recommendations']) {
                    const prompt = generateDynamicPrompt(landType, promptType);
                    const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt + " Do not include any 'Analyzing...' text in your response."
                                }]
                            }]
                        })
                    });

                    const data = await response.json();
                    if (data.candidates && data.candidates[0].content.parts[0].text) {
                        // Clean up the response text
                        let responseText = data.candidates[0].content.parts[0].text;
                        responseText = responseText
                            .replace(/Analyzing\.\.\./gi, '')
                            .replace(/Analyzing/gi, '')
                            .replace(/\.\.\./g, '')
                            .replace(/\s{2,}/g, ' ')
                            .trim();
                        insights[promptType] = responseText;
                    } else {
                        insights[promptType] = 'Unable to generate insights at this time.';
                    }
                }

                const processingTime = ((Date.now() - startTime) / 1000).toFixed(2);
                document.getElementById('processingTime').textContent = `${processingTime}s`;

                return insights;
            } catch (error) {
                console.error('Error generating insights:', error);
                return {
                    futureTrends: 'Error generating future trends.',
                    urbanPlanning: 'Error generating urban planning insights.',
                    conservation: 'Error generating conservation strategies.',
                    recommendations: ['Error generating recommendations.']
                };
            }
        }

        function updateConfidenceChart(confidence) {
            const ctx = document.getElementById('confidenceChart');
            if (!ctx) {
                console.error('Confidence chart canvas not found');
                return;
            }

            const chartContext = ctx.getContext('2d');
            
            if (confidenceChart) {
                confidenceChart.destroy();
            }

            // Calculate historical average (simulated based on typical model performance)
            const historicalAvg = Math.min(100, confidence * 100 + (Math.random() * 5 - 2.5));

            confidenceChart = new Chart(chartContext, {
                type: 'bar',
                data: {
                    labels: ['Confidence Analysis'],
                    datasets: [
                        {
                            label: 'Model Confidence',
                            data: [confidence * 100],
                            backgroundColor: `rgba(52, 152, 219, ${0.7 + (confidence * 0.3)})`,
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 1,
                            borderRadius: 5,
                            order: 2
                        },
                        {
                            label: 'Historical Average',
                            data: [historicalAvg],
                            backgroundColor: 'rgba(46, 204, 113, 0.7)',
                            borderColor: 'rgba(46, 204, 113, 1)',
                            borderWidth: 1,
                            borderRadius: 5,
                            order: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                font: {
                                    family: 'Poppins',
                                    size: 12
                                }
                            },
                            title: {
                                display: true,
                                text: 'Confidence (%)',
                                font: {
                                    family: 'Poppins',
                                    size: 14,
                                    weight: '500'
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    family: 'Poppins',
                                    size: 12
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    family: 'Poppins',
                                    size: 12
                                },
                                usePointStyle: true,
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                family: 'Poppins',
                                size: 14
                            },
                            bodyFont: {
                                family: 'Poppins',
                                size: 13
                            },
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw.toFixed(2)}%`;
                                }
                            }
                        }
                    }
                }
            });

            // Update the prediction details section
            const confidenceDiff = Math.abs(confidence * 100 - historicalAvg).toFixed(2);
            const performanceStatus = confidence * 100 >= historicalAvg ? 'Above Average' : 'Below Average';
            
            // Add performance comparison to prediction details
            const predictionDetails = document.querySelector('.prediction-stats');
            const performanceComparisonHtml = `
                <div class="stat-item">
                    <div class="stat-value">${performanceStatus}</div>
                    <div class="stat-label">Performance Status</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${confidenceDiff}%</div>
                    <div class="stat-label">Deviation from Average</div>
                </div>
            `;
            
            // Remove old comparison stats if they exist
            const oldStats = document.querySelectorAll('.stat-item');
            oldStats.forEach((stat, index) => {
                if (index > 2) { // Keep the first 3 original stats
                    stat.remove();
                }
            });
            
            // Add new comparison stats
            predictionDetails.insertAdjacentHTML('beforeend', performanceComparisonHtml);
        }

        imageUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    classifyButton.disabled = false;
                    results.style.display = 'none';
                    document.getElementById('insights').style.display = 'none';
                }
                reader.readAsDataURL(file);
            }
        });

        classifyButton.addEventListener('click', async function() {
            const file = imageUpload.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            loading.style.display = 'block';
            results.style.display = 'none';
            document.getElementById('insights').style.display = 'none';
            classifyButton.disabled = true;

            try {
                const response = await fetch('/classify', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (response.ok) {
                    landType.textContent = data.type;
                    confidence.textContent = `${(data.confidence * 100).toFixed(2)}%`;
                    results.style.display = 'block';
                    
                    // Update confidence chart
                    updateConfidenceChart(data.confidence);
                    
                    // Update image size
                    const img = new Image();
                    img.onload = function() {
                        document.getElementById('imageSize').textContent = `${this.width}x${this.height}`;
                    };
                    img.src = URL.createObjectURL(file);
                    
                    // Generate insights using Gemini API
                    const insights = await generateInsights(data.type);
                    
                    // Update the UI with generated insights
                    document.getElementById('futureTrends').innerHTML = parseMarkdown(insights.futureTrends);
                    document.getElementById('urbanPlanning').innerHTML = parseMarkdown(insights.urbanPlanning);
                    document.getElementById('conservation').innerHTML = parseMarkdown(insights.conservation);

                    // Update recommendations
                    const recommendationsList = document.getElementById('recommendationsList');
                    const recommendations = Array.isArray(insights.recommendations) 
                        ? insights.recommendations 
                        : [insights.recommendations];
                    
                    recommendationsList.innerHTML = recommendations.map(rec => `
                        <div class="recommendation-item">
                            <i class="fas fa-check-circle recommendation-icon"></i>
                            <span>${parseMarkdown(rec)}</span>
                        </div>
                    `).join('');

                    // Show insights section
                    document.getElementById('insights').style.display = 'block';
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error processing image: ' + error.message);
            } finally {
                loading.style.display = 'none';
                classifyButton.disabled = false;
            }
        });

        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');

        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        });

        function updateThemeIcon(theme) {
            themeIcon.className = theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        }

        // Add toggle functionality for insights and recommendations
        document.getElementById('insightsToggle').addEventListener('click', function() {
            const content = document.getElementById('insightsContent');
            const button = this;
            content.classList.toggle('show');
            button.classList.toggle('active');
        });

        document.getElementById('recommendationsToggle').addEventListener('click', function() {
            const content = document.getElementById('recommendationsContent');
            const button = this;
            content.classList.toggle('show');
            button.classList.toggle('active');
        });
    </script>
</body>
</html> 